<div class="container mt-2">
    <div class="row">
        <div class="col-md-8">
            <h3>お知らせ詳細画面</h3>
                <table class="table">
                    <tr>
                        <th>避難場所の画像・地図</th>
                        <td>
                            <% if @post.image.present? %>
                                <%= image_tag @post.image, size: "100x100" %>
                            <% end %>
                        </td>
                    </tr>
                    <tr>
                        <th><i class="fa-solid fa-person-running text-danger"></i>避難場所</th>
                        <td><%= @post.name %></td>
                    </tr>
                    <tr>
                        <th><i class="fa-solid fa-house text-danger"></i>避難場所に関しての説明</th>
                        <td><%= render_with_tags(@post.introduction) %></td>
                    </tr>
                    <tr>
                        <th>避難場所の住所</th>
                        <td><%= @post.address %></td>
                    </tr>
                    <tr>
                        <th>登録日時</th>
                        <td><%= @post.created_at.strftime('%Y/%m/%d') %></td>
                    </tr>
                </table>
<!--いいね表示-->
<% if @post.favorited_by?(current_customer) %>
    <p>  <!--いいね作成-->
      <%= link_to public_post_favorites_path(@post), method: :delete do %>
        <i class="fa-solid fa-heart"></i><%= @post.favorites.count %> いいね
      <% end %>
    </p>
    <% else %>
    <p>  <!--いいね削除-->
      <%= link_to public_post_favorites_path(@post), method: :post do %>
        <i class="fa-regular fa-heart"></i><%= @post.favorites.count %> いいね
      <% end %>
    </p>
<% end %>

<!--ブックマーク表示-->
<% if @post.bookmarked_by?(current_customer) %>
    <p>  <!--ブックマーク作成-->
        <%= link_to public_post_bookmarks_path(@post), method: :delete do %>
            <i class="fa-solid fa-bookmark"></i><%= @post.bookmarks.count %> ブックマーク
        <% end %>
    </p>
        <% else %>
    <p>  <!--ブックマーク削除-->
        <%= link_to public_post_bookmarks_path(@post), method: :post do %>
            <i class="fa-regular fa-bookmark"></i><%= @post.bookmarks.count %> ブックマーク
        <% end %>
    </p>
<% end %>

<!--コメント投稿-->
    <div class="mt-2">
        <%= form_with model: [@post, @comment], url: public_post_comments_path(@post) do |f| %>  <!--comment は、postに紐づくので、配列で書く-->
            <%= f.text_area :comment, size: "30x3" %>
            <%= f.submit "投稿" %>
        <% end %>
    </div>

<!--コメント表示-->
コメント件数：<%= @post.comments.count %>
    <% @post.comments.where(reply_comment:nil).each do |comment| %>
        <div style="width:55%" class="border-info border rounded m-1">
            <div class="d-flex justify-center flex-wrap">
                <p class="font-weight-bold mr-2">  <!--投稿者のIDと名前-->
                    [<%= comment.customer.id %>]
                    <%= comment.customer.last_name %><%= comment.customer.first_name %>
                </p>
                <div id="js-comment-<%= comment.id %>">  <!--投稿コメント-->
                    <%= render "public/comments/js_comment", comment: comment %>
                </div>
             </div>
                    <%= comment.created_at.strftime('%Y/%m/%d %H:%M') %>  <!--投稿日時-->

            <!--ログインしている本人のみ操作できるようにするための分岐-->
            <% if customer_signed_in? && (current_customer == comment.customer) %>
                <!--コメント削除には、@post（親）, @commentsのc に渡す必要がある-->
                <span data-comment-id=<%= comment.id %> class="js-edit-comment-button" >
                    <i class="fa-solid fa-pen-to-square ml-2 text-success"></i> 編集
                </span>

                <%= link_to public_post_comment_path(@post, comment), method: :delete, "data-confirm" => "本当に削除しますか？", class: 'text-danger' do %>
                    <i class="fa-solid fa-trash ml-2"></i> 削除
                <% end %>
            <% end %>
        </div>

<!--コメントへの返信を表示-->
    -----返信コメント-----<br>
    <% Comment.where(reply_comment: comment.id).each  do |reply_comment| %>
        <%= comment.comment %>
    <% end %>

<!--コメントに対して返信-->
    <%= form_with model: [@post, @comment], url: public_post_comments_path(@post) do |f| %>
        <div class="collapsible-body">
            <%= f.text_field :comment %>
            <!--ここ大事！hidden_fieldでフォーム無しに送信先コメントのidをreply_commentに追加-->
            <%= f.hidden_field :reply_comment, :value => comment.id  %>
            <%= button_tag type:"submit", class: "waves-effect waves-light btn" do %>
                <%= f.submit "返信する" %>
            <% end %>
        </div>
    <% end %>
<% end %>

        <%= link_to "前のページに戻る", public_posts_path, class: 'btn btn-info'  %>
        </div>
    </div>
</div>